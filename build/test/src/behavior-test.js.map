{"version":3,"sources":["src/behavior-test.js"],"names":[],"mappings":"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","file":"src/behavior-test.js","sourcesContent":["/* global describe, it, before, beforeEach */\n\nimport fs from 'fs';\nimport path from 'path';\nimport when from 'when';\nimport delay from 'when/delay';\n\nimport chai from 'chai';\nimport chaiAsPromised from 'chai-as-promised';\nchai.use(chaiAsPromised);\nlet expect = chai.expect;\n\nimport tsi from './testServerInstance';\nimport config from '../config';\nimport util from './util';\n\nimport Snoocore from '../../src/Snoocore';\n\ndescribe(__filename, function () {\n\n  this.timeout(config.testTimeout);\n\n  it('should get resources when logged in', function() {\n    var reddit = util.getScriptInstance([ 'identity' ]);\n    return reddit.auth().then(reddit('/api/v1/me').get).then(function(result) {\n      expect(result.name).to.equal(config.reddit.login.username);\n    });\n  });\n\n  it('should GET resources when logged in (respect parameters)', function() {\n    var reddit = util.getScriptInstance([ 'mysubreddits' ]);\n\n    return reddit.auth().then(function() {\n      return reddit('/subreddits/mine/$where').get({\n        $where: 'subscriber',\n        limit: 2\n      });\n    }).then(function(result) {\n      expect(result.data.children.length).to.equal(2);\n    });\n  });\n\n  it('should be able to upload files in Node', function() {\n    var reddit = util.getScriptInstance([ 'modconfig' ]);\n\n    // @TODO maybe just move the images into the build/test/src\n    // folder!\n    var appIcon = path.join(__dirname, '..', '..', '..',\n                            'test', 'src', 'img', 'appicon.png');\n\n    return reddit.auth().then(function() {\n      return reddit('/r/$subreddit/api/delete_sr_header').post({\n        $subreddit: config.reddit.testSubreddit\n      });\n    }).then(function() {\n      return reddit('/r/$subreddit/api/upload_sr_img').post({\n        $subreddit: config.reddit.testSubreddit,\n        file: Snoocore.file('appicon.png', 'image/png', fs.readFileSync(appIcon)),\n        header: 1,\n        img_type: 'png',\n        name: 'test-foo-bar'\n      });\n    });\n  });\n\n  it('should sub/unsub from a subreddit (POST)', function() {\n\n    var reddit = util.getScriptInstance([ 'read', 'subscribe' ]);\n\n    return reddit.auth().then(function() {\n      return reddit('/r/$subreddit/about').get({\n        $subreddit: config.reddit.testSubreddit\n      });\n    }).then(function(response) {\n\n      var subName = response.data.name;\n      var isSubbed = response.data.user_is_subscriber;\n\n\n\n      return reddit('api/subscribe').post({\n        action: isSubbed ? 'unsub' : 'sub',\n        sr: subName\n      }).then(function() {\n        return reddit('/r/$subreddit/about').get({\n          $subreddit: config.reddit.testSubreddit\n        });\n      }).then(function(secondResp) {\n        // should have subbed / unsubbed from the subreddit\n        expect(secondResp.data.user_is_subscriber).to.equal(!isSubbed);\n      });\n    });\n\n  });\n\n  it('should auto-fill api_type to be \"json\"', function() {\n\n    var reddit = util.getScriptInstance([ 'read', 'modconfig' ]);\n\n    return reddit.auth().then(function() {\n      return reddit('/r/$subreddit/about/edit.json').get({\n        $subreddit: config.reddit.testSubreddit\n      });\n    }).then(function(result) {\n      var data = result.data;\n      return reddit('/api/site_admin').post(data);\n    }).catch(function(error) {\n      expect(error.message.indexOf('BAD_SR_NAME')).to.not.equal(-1);\n    });\n  });\n\n  // Can only test this in node based environments. The browser tests\n  // are unable to unset the cookies (when using user/pass auth).\n  //\n  // Browsers are unable to authenticate anyway, unless using a chrome\n  // extension. If this is the case, they should use OAuth for authentication\n  // and then bypass will work.\n  it('should bypass authentication for calls when set', function() {\n\n    var reddit = util.getScriptInstance([ 'read', 'subscribe' ]);\n\n    return reddit.auth().then(function() {\n      return reddit('/r/$subreddit/about').get({\n        $subreddit: config.reddit.testSubreddit\n      });\n    }).then(function(response) {\n      var subName = response.data.name;\n      var isSubbed = response.data.user_is_subscriber;\n\n      // make sure the user is subscribed\n      return isSubbed ? when.resolve() : reddit('/api/subscribe').post({\n        action: 'sub',\n        sr: subName\n      });\n\n    }).then(function() {\n      return reddit('/r/$subreddit/about').get({\n        $subreddit: config.reddit.testSubreddit\n      });\n    }).then(function(result) {\n      // check that they are subscribed!\n      expect(result.data.user_is_subscriber).to.equal(true);\n      // run another request, but make it unauthenticated (bypass)\n      return reddit('/r/$subreddit/about').get(\n        { $subreddit: config.reddit.testSubreddit },\n        { bypassAuth: true });\n    }).then(function(result) {\n      expect(result.data.user_is_subscriber).to.not.equal(true);\n    });\n  });\n\n  it('should GET resources while not logged in', function() {\n\n    var reddit = util.getImplicitInstance([ 'read' ]);\n\n    return reddit('/r/$subreddit/new').get({\n      $subreddit: 'pcmasterrace'\n    }).then(function(result) {\n      var subreddit = result.data.children[0].data.subreddit;\n      expect(subreddit).to.equal('pcmasterrace');\n    });\n  });\n\n  it('should not decode html', function() {\n    var reddit = util.getScriptInstance([ 'read' ]);\n    return reddit('/r/snoocoreTest/about.json').get().then(function(result) {\n      expect(result.data.description_html.indexOf('&lt;/p&gt;')).to.not.equal(-1);\n    });\n  });\n\n  it('should decode html on a per call basis', function() {\n    var reddit = util.getScriptInstance([ 'read' ]);\n    return reddit('/r/snoocoreTest/about.json').get(null, {\n      decodeHtmlEntities: true\n    }).then(function(result) {\n      expect(result.data.description_html.indexOf('</p>')).to.not.equal(-1);\n    });\n  });\n\n  it('should decode html globally & respect per call override', function() {\n\n    var reddit = util.getScriptInstance([ 'read' ]);\n\n    var secondReddit = new Snoocore({\n      userAgent: 'foobar',\n      decodeHtmlEntities: true,\n      oauth: {\n        type: 'implicit',\n        key: config.reddit.installed.key,\n        redirectUri: '_',\n        scope: [ 'read' ]\n      }\n    });\n\n    return secondReddit('/r/snoocoreTest/about.json').get().then(function(result) {\n      expect(result.data.description_html.indexOf('</p>')).to.not.equal(-1);\n\n      // override global 'true'\n      return reddit('/r/snoocoreTest/about.json').get(null, { decodeHtmlEntities: false });\n    }).then(function(result) {\n      expect(result.data.description_html.indexOf('&lt;/p&gt;')).to.not.equal(-1);\n    });\n  });\n\n  it('application only oauth calling a user specific endpoint should fail', function() {\n    var reddit = util.getScriptInstance();\n    return reddit('/api/v1/me').get().then(function(data) {\n      throw new Error('should not pass, expect to fail with error');\n    }).catch(function(error) {\n      return expect(error.message.indexOf(\n        'Must be authenticated with a user to make this call')).to.not.equal(-1);\n    });\n  });\n\n  describe('Explicit internal configuration (duration permanent)', function() {\n\n    it('should auth, get refresh token, deauth, use refresh token to reauth, deauth(true) -> refresh', function() {\n\n      var reddit = util.getExplicitInstance([ 'identity' ], 'permanent');\n\n      var url = reddit.getExplicitAuthUrl();\n\n      return tsi.standardServer.allowAuthUrl(url).then(function(params) {\n        var authorizationCode = params.code;\n        return reddit.auth(authorizationCode).then(function(refreshToken) {\n\n          return reddit('/api/v1/me').get().then(function(data) {\n\n            expect(data.name).to.be.a('string');\n\n            // deauthenticae with the current access token (e.g. \"logoff\")\n            return reddit.deauth().then(function() {\n              // get a new access token / re-authenticating by refreshing\n              // the given refresh token\n              return reddit.refresh(refreshToken);\n            });\n          }).then(function() {\n            expect(reddit.oauth.isAuthenticated()).to.equal(true);\n            // deauthenticae by removing the refresh token\n            return reddit.deauth(refreshToken).then(function() {\n              // does NOT automatically get a net access token as we have\n              // removed it entirely\n              return expect(reddit('/api/v1/me').get()).to.eventually.be.rejected;\n            });\n          }).then(function() {\n            // try to re-authenticate & get a new access token with the\n            // revoked refresh token and see that it fails\n            return expect(reddit.refresh(refreshToken)).to.eventually.be.rejected;\n          });\n        });\n      });\n    });\n\n    it('should auth, deauth (simulate expired access token), call endpoint which will request a new access token', function() {\n\n      var reddit = util.getExplicitInstance([ 'identity' ], 'permanent');\n\n      var url = reddit.getExplicitAuthUrl();\n\n      return tsi.standardServer.allowAuthUrl(url).then(function(params) {\n        var authorizationCode = params.code;\n        return reddit.auth(authorizationCode).then(function(refreshToken) {\n\n          return reddit('/api/v1/me').get().then(function(data) {\n            expect(data.name).to.be.a('string');\n            // invalidate the current access token (as if it expired)\n            reddit.oauth.accessToken = 'invalidToken';\n          }).then(function() {\n            // by calling this, it will automatically request a new refresh token\n            // if the one we were using has expired. The call will take a bit\n            // longer to complete as it requests a new access token first\n            return reddit('/api/v1/me').get();\n          }).then(function(data) {\n            expect(data.name).to.be.a('string');\n          }).then(function() {\n            // deauthenticae by removing the refresh token\n            return reddit.deauth(refreshToken).then(function() {\n              return expect(reddit('/api/v1/me').get()).to.eventually.be.rejected;\n            });\n          }).then(function() {\n            // try to re-authenticate & get a new access token with the\n            // revoked refresh token and see that it fails\n            return expect(reddit.refresh(refreshToken)).to.eventually.be.rejected;\n          });\n        });\n      });\n    });\n\n\n    it('auth (script), expire access token (simulated), then reauth', function() {\n      var reddit = util.getScriptInstance([ 'identity' ]);\n      var authTokenA;\n      var authTokenB;\n\n      return reddit.auth().then(function() {\n        return reddit('/api/v1/me').get();\n      }).then(function(data) {\n        expect(data.name).to.be.a('string');\n        authTokenA = reddit.oauth.accessToken;\n        // \"timeout\" - simulate expired access token\n        reddit.oauth.accessToken = 'invalidToken';\n      }).then(function() {\n        return reddit('/api/v1/me').get();\n      }).then(function(data) {\n        expect(data.name).to.be.a('string');\n        authTokenB = reddit.oauth.accessToken;\n        expect(authTokenA === authTokenB).to.equal(false);\n      });\n    });\n\n    it('should auth (script), deauth, and not reauth', function() {\n      var reddit = util.getScriptInstance([ 'identity' ]);\n\n      return reddit.auth().then(function() {\n        return reddit('/api/v1/me').get();\n      }).then(function(data) {\n        expect(data.name).to.be.a('string');\n        return reddit.deauth();\n      }).then(function() {\n        return reddit('/api/v1/me').get();\n      }).catch(function(error) {\n        return expect(error.message.indexOf(\n          'Must be authenticated with a user to make this call')).to.not.equal(-1);\n      });\n    });\n\n  });\n\n  describe('Explicit internal configuration (duration temporary)', function() {\n\n\n    it('should auth, and call an oauth endpoint', function() {\n\n      var reddit = util.getExplicitInstance([ 'identity' ]);\n\n      var url = reddit.getExplicitAuthUrl();\n\n      return tsi.standardServer.allowAuthUrl(url).then(function(params) {\n        var authorizationCode = params.code;\n        return reddit.auth(authorizationCode).then(function() {\n          return reddit('/api/v1/me').get();\n        }).then(function(data) {\n          expect(data.error).to.be.undefined;\n          expect(data.name).to.be.a('string');\n        });\n      });\n    });\n\n    it('should auth, and call an oauth endpoint (check state)', function() {\n\n      var reddit = util.getExplicitInstance([ 'identity' ]);\n      var state = 'foobar';\n      var url = reddit.getExplicitAuthUrl(state);\n\n      return tsi.standardServer.allowAuthUrl(url).then(function(params) {\n\n        expect(params.state).to.equal(state);\n\n        var authorizationCode = params.code;\n        return reddit.auth(authorizationCode).then(function() {\n          return reddit('/api/v1/me').get();\n        }).then(function(data) {\n          expect(data.error).to.be.undefined;\n          expect(data.name).to.be.a('string');\n        });\n      });\n    });\n\n  });\n\n  describe('Implicit internal configuration', function() {\n\n    it('should auth, and call an oauth endpoint', function() {\n\n      var reddit = util.getImplicitInstance([ 'identity' ]);\n\n      var state = 'foobar';\n      var url = reddit.getImplicitAuthUrl(state);\n\n      return tsi.standardServer.allowAuthUrl(url).then(function(params) {\n\n        expect(params.state).to.equal(state);\n\n        var accessToken = params['access_token'];\n\n        return reddit.auth(accessToken).then(function() {\n          return reddit('/api/v1/me').get();\n        }).then(function(data) {\n          expect(data.error).to.be.undefined;\n          expect(data.name).to.be.a('string');\n          // \"expire\" the access token\n\n\n          reddit.oauth.accessToken = 'some_invalid_token_1234';\n\n          return when.promise(function(resolve, reject) {\n\n            var tokenExpired = false;\n\n            reddit.on('access_token_expired', function() {\n              tokenExpired = true;\n            });\n\n            reddit('/api/v1/me').get().then(function() {\n              // Should fail! reject this promise if it did not.\n              return reject(new Error('should not GET'));\n            }).catch(function(error) {\n              // If the token did not expire, this is a fail!\n              if (!tokenExpired) {\n                return reject(new Error('did not fire when token expired'));\n              }\n\n              expect(error.message.indexOf(\n                'Access token has expired. ' +\n                'Listen for the \"access_token_expired\" event to ' +\n                'handle this gracefully in your app.')).to.not.equal(-1);\n\n              resolve();\n            });\n          });\n\n\n        });\n      });\n\n    });\n\n  });\n\n  describe('Script internal configuration Authenticate tests', function() {\n\n    it('should authenticate with OAuth, and call an oauth endpoint', function() {\n\n      var reddit = util.getScriptInstance();\n\n      return reddit.auth().then(reddit('/api/v1/me').get).then(function(data) {\n        expect(data.error).to.be.undefined;\n        expect(data.name).to.be.a('string');\n      });\n    });\n  });\n\n  describe('Application only OAuth', function() {\n\n    it('(implicit client) Application only OAuth', function() {\n      var reddit = util.getImplicitInstance([ 'read' ]);\n\n      // OAuth only endpoint.\n      return reddit('/api/v1/user/$username/trophies').get({\n        $username: 'tsenior'\n      }).then(function(result) {\n        expect(result.kind).to.equal('TrophyList');\n      });\n    });\n\n    it('(explicit/script client) Application only OAuth', function() {\n      var reddit = util.getScriptInstance([ 'read' ]);\n\n      // OAuth only endpoint.\n      return reddit('/api/v1/user/$username/trophies').get({\n        $username: 'tsenior'\n      }).then(function(result) {\n        expect(result.kind).to.equal('TrophyList');\n      });\n    });\n\n  });\n\n  describe('General Reddit API Tests using OAuth', function() {\n\n    it('should get resources when logged in', function() {\n\n      var reddit = util.getScriptInstance([ 'identity', 'mysubreddits' ]);\n\n      return reddit.auth()\n                   .then(reddit('/api/v1/me').get)\n                   .then(function(data) {\n                     expect(data.name).to.equal(config.reddit.login.username);\n                   });\n    });\n\n    it('should GET resources when logged in (respect parameters)', function() {\n\n      var reddit = util.getScriptInstance([ 'identity', 'mysubreddits' ]);\n\n      return reddit.auth().then(function() {\n        return reddit('/subreddits/mine/$where').get({\n          $where: 'subscriber',\n          limit: 2\n        });\n      }).then(function(result) {\n        expect(result.data.children.length).to.equal(2);\n      });\n    });\n\n  });\n\n});\n"],"sourceRoot":"/source/"}